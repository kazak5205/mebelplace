# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ª–∞–π–∫–æ–≤

**–î–∞—Ç–∞:** 24 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–∞–π–∫–æ–≤ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

## üîç –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –°–∏–º–ø—Ç–æ–º—ã:
1. **–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:** 1 –ª–∞–π–∫ ‚úÖ
2. **API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `like_count: 1` ‚úÖ
3. **–ù–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** 10 –ª–∞–π–∫–æ–≤ ‚ùå

### –ü—Ä–∏—á–∏–Ω–∞ 1: COUNT() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ —á–∏—Å–ª–∞

PostgreSQL `COUNT()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø `bigint`, –∫–æ—Ç–æ—Ä—ã–π pg-–¥—Ä–∞–π–≤–µ—Ä Node.js –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ **—Å—Ç—Ä–æ–∫—É** –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è JavaScript Number.

**API –≤–æ–∑–≤—Ä–∞—â–∞–ª–æ:**
```json
{
  "likes": 1,
  "like_count": "1"  ‚Üê —Å—Ç—Ä–æ–∫–∞ –≤–º–µ—Å—Ç–æ —á–∏—Å–ª–∞!
}
```

**–ü–æ—Å–ª–µ camelCase —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:**
```json
{
  "likes": 1,
  "likeCount": "1"  ‚Üê –≤—Å—ë –µ—â—ë —Å—Ç—Ä–æ–∫–∞!
}
```

### –ü—Ä–∏—á–∏–Ω–∞ 2: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–ª —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ

```typescript
// VideoPlayer.tsx:433
likeCount: currentVideo.likeCount || 0  ‚Üê "1" || 0 = "1" (—Å—Ç—Ä–æ–∫–∞!)
```

–°—Ç—Ä–æ–∫–∞ `"1"` —è–≤–ª—è–µ—Ç—Å—è truthy –∑–Ω–∞—á–µ–Ω–∏–µ–º, –ø–æ—ç—Ç–æ–º—É `|| 0` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. Backend: –Ø–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ integer (server/routes/videos.js)

–î–æ–±–∞–≤–ª–µ–Ω–æ `::int` –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–∞:

```sql
-- –ë–´–õ–û:
COUNT(DISTINCT vl.id) as like_count

-- –°–¢–ê–õ–û:
COUNT(DISTINCT vl.id)::int as like_count
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ 3 –º–µ—Å—Ç–∞—Ö:**
- `GET /api/videos/feed` - –æ—Å–Ω–æ–≤–Ω–æ–π feed (—Å—Ç—Ä–æ–∫–∏ 103, 104)
- `GET /api/videos/feed` - –∞–¥–º–∏–Ω—Å–∫–∏–µ –≤–∏–¥–µ–æ (—Å—Ç—Ä–æ–∫–∏ 145, 146)
- `GET /api/videos/:id` - –æ–¥–Ω–æ –≤–∏–¥–µ–æ (—Å—Ç—Ä–æ–∫–∏ 639, 640)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "likes": 1,
  "like_count": 1  ‚Üê —Ç–µ–ø–µ—Ä—å —á–∏—Å–ª–æ!
}
```

### 2. Frontend: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (client/src/components/VideoPlayer.tsx)

–î–æ–±–∞–≤–ª–µ–Ω `parseInt()` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —á–∏—Å–ª–æ–≤–æ–≥–æ —Ç–∏–ø–∞:

```typescript
// –ë–´–õ–û:
likeCount: currentVideo.likeCount || 0

// –°–¢–ê–õ–û:
likeCount: parseInt(currentVideo.likeCount as any) || currentVideo.likes || 0
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ 2 –º–µ—Å—Ç–∞—Ö:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ 433)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∞–π–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 213)

### 3. Types: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TypeScript —Ç–∏–ø–æ–≤ (client/src/types/index.ts)

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è:

```typescript
export interface Video {
  // ...
  likes?: number;              ‚Üê –¥–æ–±–∞–≤–ª–µ–Ω–æ
  likeCount?: number | string; ‚Üê —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –æ–±–∞ —Ç–∏–ø–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  // ...
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

**API:**
```json
{
  "likes": 1,
  "like_count": "1"  ‚Üê —Å—Ç—Ä–æ–∫–∞
}
```

**–§—Ä–æ–Ω—Ç–µ–Ω–¥:**
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç 10 –∏–ª–∏ –¥—Ä—É–≥–æ–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
- –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

**API:**
```json
{
  "likes": 1,
  "like_count": 1  ‚Üê —á–∏—Å–ª–æ
}
```

**–§—Ä–æ–Ω—Ç–µ–Ω–¥:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç 1 –ª–∞–π–∫
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤

## üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:

1. ‚úÖ **Backend:**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `/opt/mebelplace/server/routes/videos.js`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

2. ‚úÖ **Frontend:**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `/opt/mebelplace/client/src/components/VideoPlayer.tsx`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `/opt/mebelplace/client/src/types/index.ts`
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω (`npm run build`)
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx

3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
   - API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–∞: `curl https://mebelplace.com.kz/api/videos/...`
   - –¢–∏–ø—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ: `"like_count": "number"`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
```bash
curl -s "https://mebelplace.com.kz/api/videos/3cd91b71-e2ec-4889-b963-0ea2d4329dad" \
  | jq '.data | {likes, like_count, comment_count}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "likes": 1,
  "like_count": 1,
  "comment_count": 3
}
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã
```bash
curl -s "https://mebelplace.com.kz/api/videos/3cd91b71-e2ec-4889-b963-0ea2d4329dad" \
  | jq '.data | {likes, like_count, comment_count} | map_values(type)'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "likes": "number",
  "like_count": "number",
  "comment_count": "number"
}
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–∞–π—Ç–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://mebelplace.com.kz
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à: **Ctrl + Shift + R** (Windows/Linux) –∏–ª–∏ **Cmd + Shift + R** (Mac)
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∏–¥–µ–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **1**, –∞ –Ω–µ 10

## üí° –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ü–æ—á–µ–º—É COUNT() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É?

PostgreSQL `COUNT()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `bigint` (64-bit integer), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ JavaScript Number (2^53 - 1).

pg-–¥—Ä–∞–π–≤–µ—Ä Node.js **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç `bigint` –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –†–µ—à–µ–Ω–∏—è:

1. **–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤ SQL:** `COUNT(...)::int` ‚Üê –Ω–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ
   - ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (< 2 –º–ª—Ä–¥)
   - ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ–≥—Ä–æ–º–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ pg-–¥—Ä–∞–π–≤–µ—Ä–∞:**
   ```javascript
   pg.types.setTypeParser(20, val => parseInt(val))
   ```
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ
   - ‚ö†Ô∏è –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –¥—Ä—É–≥–æ–π –∫–æ–¥

3. **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:** `parseInt()` ‚Üê –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞
   - ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ API –≤–µ—Ä–Ω—ë—Ç —Å—Ç—Ä–æ–∫—É

### –ù–∞—à –ø–æ–¥—Ö–æ–¥: –ó–∞—â–∏—Ç–∞ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

–ú—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ **–æ–±–æ–∏—Ö —É—Ä–æ–≤–Ω—è—Ö**:
- **Backend:** `::int` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ –∏–∑ –ë–î
- **Frontend:** `parseInt()` –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å! üõ°Ô∏è

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—Ä—É–≥–∏–µ –º–µ—Å—Ç–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è COUNT():

```bash
grep -r "COUNT(" server/ | grep -v "::int" | grep -v "DISTINCT"
```

## üìù –í—ã–≤–æ–¥—ã

**–ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. PostgreSQL COUNT() ‚Üí bigint ‚Üí —Å—Ç—Ä–æ–∫–∞ –≤ Node.js
2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–ª —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ

**–†–µ—à–µ–Ω–∏—è:**
1. Backend: `COUNT(...)::int` –¥–ª—è —è–≤–Ω–æ–≥–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–∞
2. Frontend: `parseInt()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
3. Types: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–¢–∏–ø:** Type Mismatch / Data Display Bug

---

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –≤—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

