# üé¨ –ü–û–õ–ù–´–ô –§–õ–û–£ –í–°–ï–• –°–¶–ï–ù–ê–†–ò–ï–í MEBELPLACE

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

### üë§ **–ë–ê–ó–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò**
1. [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥](#1-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–∏-–≤—Ö–æ–¥)
2. [–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–µ–Ω—Ç—ã –≤–∏–¥–µ–æ](#2-–ø—Ä–æ—Å–º–æ—Ç—Ä-–ª–µ–Ω—Ç—ã-–≤–∏–¥–µ–æ)
3. [–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∏–¥–µ–æ](#3-–ø—Ä–æ—Å–º–æ—Ç—Ä-–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ-–≤–∏–¥–µ–æ)
4. [–ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ –∏ –º–∞—Å—Ç–µ—Ä–æ–≤](#4-–ø–æ–∏—Å–∫-–≤–∏–¥–µ–æ-–∏-–º–∞—Å—Ç–µ—Ä–æ–≤)

### ‚ù§Ô∏è **–í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï –° –ö–û–ù–¢–ï–ù–¢–û–ú**
5. [–õ–∞–π–∫ –≤–∏–¥–µ–æ](#5-–ª–∞–π–∫-–≤–∏–¥–µ–æ)
6. [–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ](#6-–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–≤–∏–¥–µ–æ)
7. [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∑–∞–∫–ª–∞–¥–∫–∏](#7-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–≤-–∑–∞–∫–ª–∞–¥–∫–∏)
8. [–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–∞—Å—Ç–µ—Ä–∞](#8-–ø–æ–¥–ø–∏—Å–∫–∞-–Ω–∞-–º–∞—Å—Ç–µ—Ä–∞)

### üõ†Ô∏è **–†–ê–ë–û–¢–ê –° –ó–ê–ö–ê–ó–ê–ú–ò**
9. [–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–∫–ª–∏–µ–Ω—Ç)](#9-—Å–æ–∑–¥–∞–Ω–∏–µ-–∑–∞–∫–∞–∑–∞-–∫–ª–∏–µ–Ω—Ç)
10. [–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤](#10-–ø—Ä–æ—Å–º–æ—Ç—Ä-–∑–∞–∫–∞–∑–æ–≤)
11. [–û—Ç–∫–ª–∏–∫ –Ω–∞ –∑–∞–∫–∞–∑ (–º–∞—Å—Ç–µ—Ä)](#11-–æ—Ç–∫–ª–∏–∫-–Ω–∞-–∑–∞–∫–∞–∑-–º–∞—Å—Ç–µ—Ä)
12. [–ü—Ä–∏–Ω—è—Ç–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞ (–∫–ª–∏–µ–Ω—Ç)](#12-–ø—Ä–∏–Ω—è—Ç–∏–µ–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ-–æ—Ç–∫–ª–∏–∫–∞-–∫–ª–∏–µ–Ω—Ç)
13. [–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞](#13-–∏–∑–º–µ–Ω–µ–Ω–∏–µ-—Å—Ç–∞—Ç—É—Å–∞-–∑–∞–∫–∞–∑–∞)

### üí¨ **–û–ë–©–ï–ù–ò–ï**
14. [–°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞](#14-—Å–æ–∑–¥–∞–Ω–∏–µ-—á–∞—Ç–∞)
15. [–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π](#15-–æ—Ç–ø—Ä–∞–≤–∫–∞-—Å–æ–æ–±—â–µ–Ω–∏–π)
16. [–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —á–∞—Ç](#16-–æ—Ç–ø—Ä–∞–≤–∫–∞-—Ñ–∞–π–ª–æ–≤-–≤-—á–∞—Ç)

### üé• **–°–û–ó–î–ê–ù–ò–ï –ö–û–ù–¢–ï–ù–¢–ê (–ú–ê–°–¢–ï–†)**
17. [–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ](#17-–∑–∞–≥—Ä—É–∑–∫–∞-–≤–∏–¥–µ–æ-–º–∞—Å—Ç–µ—Ä)
18. [–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–µ–æ](#18-–ø—Ä–æ—Å–º–æ—Ç—Ä-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏-–≤–∏–¥–µ–æ)

### üë®‚Äçüíº **–ü–†–û–§–ò–õ–¨ –ò –ù–ê–°–¢–†–û–ô–ö–ò**
19. [–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è](#19-–ø—Ä–æ—Å–º–æ—Ç—Ä-–ø—Ä–æ—Ñ–∏–ª—è)
20. [–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è](#20-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø—Ä–æ—Ñ–∏–ª—è)
21. [–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–Ω–∞–ª–∞ –º–∞—Å—Ç–µ—Ä–∞](#21-–ø—Ä–æ—Å–º–æ—Ç—Ä-–∫–∞–Ω–∞–ª–∞-–º–∞—Å—Ç–µ—Ä–∞)

### üîî **–£–í–ï–î–û–ú–õ–ï–ù–ò–Ø**
22. [–ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#22-–ø–æ–ª—É—á–µ–Ω–∏–µ-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
23. [Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](#23-push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

### üîê **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨**
24. [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞](#24-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-—Ç–æ–∫–µ–Ω–∞)
25. [–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞](#25-–≤—ã—Ö–æ–¥-–∏–∑-–∞–∫–∫–∞—É–Ω—Ç–∞)

---

# –î–ï–¢–ê–õ–¨–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –°–¶–ï–ù–ê–†–ò–ï–í

---

## 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 1.1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

#### –£—á–∞—Å—Ç–Ω–∏–∫–∏:
- –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

#### –®–∞–≥–∏:

**–®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ**
```
–ü–æ–ª—è —Ñ–æ—Ä–º—ã:
- Email
- –ü–∞—Ä–æ–ª—å
- –ò–º—è
- –§–∞–º–∏–ª–∏—è
- –†–æ–ª—å (client/master)
```

**–®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞**
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "ivan@example.com",
  "password": "SecurePass123",
  "firstName": "–ò–≤–∞–Ω",
  "lastName": "–ò–≤–∞–Ω–æ–≤",
  "role": "client"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**
```javascript
// current-server/routes/auth.js:45
1. –ü—Ä–æ–≤–µ—Ä–∫–∞: email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
   SELECT * FROM users WHERE email = 'ivan@example.com'
   
2. –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí 400 "User already exists"

3. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è
   const hashedPassword = await bcrypt.hash(password, 10)

4. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   INSERT INTO users (email, password_hash, first_name, last_name, role, username)
   VALUES ($1, $2, $3, $4, $5, $6)
   RETURNING id, email, first_name, last_name, role, username

5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
   const accessToken = jwt.sign({ userId, role }, SECRET, { expiresIn: '1h' })
   const refreshToken = jwt.sign({ userId }, SECRET, { expiresIn: '7d' })

6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ refresh —Ç–æ–∫–µ–Ω–∞
   INSERT INTO refresh_tokens (user_id, token, expires_at)
   VALUES ($1, $2, NOW() + INTERVAL '7 days')
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "123",
      "email": "ivan@example.com",
      "first_name": "–ò–≤–∞–Ω",
      "last_name": "–ò–≤–∞–Ω–æ–≤",
      "role": "client",
      "username": "ivan_123"
    },
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
  },
  "message": "Registration successful"
}
```

**–®–∞–≥ 5: –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç**
```typescript
// client/src/services/api.ts
1. ApiService.transformKeys() –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç:
   access_token ‚Üí accessToken
   refresh_token ‚Üí refreshToken
   
2. localStorage.setItem('accessToken', response.data.accessToken)
3. localStorage.setItem('refreshToken', response.data.refreshToken)
4. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 1.2: –í—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

**–®–∞–≥ 1: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö**
```
- Email
- –ü–∞—Ä–æ–ª—å
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "ivan@example.com",
  "password": "SecurePass123"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
1. –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   SELECT * FROM users WHERE email = 'ivan@example.com' AND is_active = true

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
   const isValid = await bcrypt.compare(password, user.password_hash)

3. –ï—Å–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ ‚Üí 401 "Invalid credentials"

4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
5. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö refresh —Ç–æ–∫–µ–Ω–æ–≤ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ refresh —Ç–æ–∫–µ–Ω–∞
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "123",
      "email": "ivan@example.com",
      "first_name": "–ò–≤–∞–Ω",
      "last_name": "–ò–≤–∞–Ω–æ–≤",
      "role": "client"
    },
    "access_token": "–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω",
    "refresh_token": "–Ω–æ–≤—ã–π_refresh_—Ç–æ–∫–µ–Ω"
  }
}
```

---

## 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–µ–Ω—Ç—ã –≤–∏–¥–µ–æ

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 2.1: –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–Ω—Ç—ã –≤–∏–¥–µ–æ**

#### –£—á–∞—Å—Ç–Ω–∏–∫–∏:
- –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏–ª–∏ –≥–æ—Å—Ç—å)

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å –ª–µ–Ω—Ç—ã**
```http
GET /api/videos/feed?page=1&limit=10&category=kitchen
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**
```javascript
// current-server/routes/videos.js:93

1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   page = 1, limit = 10, category = 'kitchen'
   offset = (1 - 1) * 10 = 0

2. –ó–∞–ø—Ä–æ—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –≤–∏–¥–µ–æ (–æ—Ç –∞–¥–º–∏–Ω–∞)
   SELECT * FROM videos 
   WHERE is_active = true 
     AND is_public = true 
     AND admin_priority > 0
   ORDER BY admin_priority DESC, created_at DESC

3. –ó–∞–ø—Ä–æ—Å –æ–±—ã—á–Ω—ã—Ö –≤–∏–¥–µ–æ
   SELECT v.*, u.username, u.avatar, u.first_name, u.last_name,
          COUNT(DISTINCT vl.id) as likes_count,
          COUNT(DISTINCT vc.id) as comments_count,
          COUNT(DISTINCT vv.id) as views_count
   FROM videos v
   LEFT JOIN users u ON v.author_id = u.id
   LEFT JOIN video_likes vl ON v.id = vl.video_id
   LEFT JOIN video_comments vc ON v.id = vc.video_id
   LEFT JOIN video_views vv ON v.id = vv.video_id
   WHERE v.is_active = true 
     AND v.is_public = true
     AND v.admin_priority = 0
     AND v.category = 'kitchen'  -- –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
   GROUP BY v.id, u.id
   ORDER BY v.created_at DESC
   LIMIT 10 OFFSET 0

4. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
   –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–∞–π–∫
   SELECT id FROM video_likes 
   WHERE video_id = $1 AND user_id = $2

5. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã (–∫–∞–∂–¥–æ–µ 5-–µ –≤–∏–¥–µ–æ - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ)
   Feed = [video1, video2, video3, video4, priorityVideo1, 
           video5, video6, video7, video8, priorityVideo2, ...]

6. –ü–æ–¥—Å—á—ë—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
   SELECT COUNT(*) FROM videos 
   WHERE is_active = true AND is_public = true
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "videos": [
      {
        "id": "1",
        "title": "–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –ª–æ—Ñ—Ç",
        "description": "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫—É—Ö–Ω—è...",
        "video_url": "/uploads/videos/video-123.mp4",
        "thumbnail_url": "/uploads/thumbnails/thumb-123.jpg",
        "duration": 180,
        "author_id": "456",
        "category": "kitchen",
        "likes_count": 42,
        "comments_count": 15,
        "views_count": 1250,
        "is_liked": false,
        "created_at": "2024-01-15T10:30:00Z",
        "author": {
          "username": "master_ivan",
          "avatar": "/uploads/avatars/456.jpg",
          "first_name": "–ò–≤–∞–Ω",
          "last_name": "–ü–µ—Ç—Ä–æ–≤"
        }
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 156,
      "pages": 16
    }
  }
}
```

**–®–∞–≥ 4: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç**
```typescript
// client/src/pages/HomePage.tsx
1. ApiService —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç: video_url ‚Üí videoUrl, likes_count ‚Üí likesCount
2. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
3. Infinite scroll - –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è page=2
```

---

## 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∏–¥–µ–æ

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 3.1: –û—Ç–∫—Ä—ã—Ç–∏–µ –≤–∏–¥–µ–æ**

**–®–∞–≥ 1: –ö–ª–∏–∫ –Ω–∞ –≤–∏–¥–µ–æ**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å –≤–∏–¥–µ–æ**
```http
GET /api/videos/123
Authorization: Bearer <token>  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/videos.js:833

1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ
   SELECT v.*, u.username, u.avatar, u.first_name, u.last_name,
          COUNT(DISTINCT vl.id) as likes_count,
          COUNT(DISTINCT vc.id) as comments_count,
          COUNT(DISTINCT vv.id) as views_count
   FROM videos v
   LEFT JOIN users u ON v.author_id = u.id
   LEFT JOIN video_likes vl ON v.id = vl.video_id
   LEFT JOIN video_comments vc ON v.id = vc.video_id
   LEFT JOIN video_views vv ON v.id = vv.video_id
   WHERE v.id = '123' AND v.is_active = true
   GROUP BY v.id, u.id

2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí 404

3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∞–π–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫–ª–∞–¥–∫–∏
```

**–®–∞–≥ 4: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞**
```http
POST /api/videos/123/view
Authorization: Bearer <token>  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

```javascript
// current-server/routes/videos.js:709

1. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
   INSERT INTO video_views (video_id, user_id, watched_at)
   VALUES ('123', 'user_id', NOW())
   ON CONFLICT (video_id, user_id) DO UPDATE SET watched_at = NOW()

2. –ï—Å–ª–∏ –≥–æ—Å—Ç—å:
   INSERT INTO video_views (video_id, watched_at)
   VALUES ('123', NOW())

3. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
   UPDATE videos SET views_count = views_count + 1 WHERE id = '123'
```

**–®–∞–≥ 5: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**
```http
GET /api/videos/123/comments?page=1&limit=20
```

```javascript
// current-server/routes/videos.js:649

SELECT vc.*, u.username, u.avatar, u.first_name, u.last_name,
       COUNT(vcl.id) as likes_count
FROM video_comments vc
LEFT JOIN users u ON vc.user_id = u.id
LEFT JOIN video_comment_likes vcl ON vc.id = vcl.comment_id
WHERE vc.video_id = '123' AND vc.is_active = true
GROUP BY vc.id, u.id
ORDER BY vc.created_at DESC
LIMIT 20
```

**–®–∞–≥ 6: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "comments": [
      {
        "id": "1",
        "content": "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!",
        "user_id": "789",
        "video_id": "123",
        "likes_count": 5,
        "created_at": "2024-01-15T11:00:00Z",
        "user": {
          "username": "anna_designer",
          "avatar": "/uploads/avatars/789.jpg"
        }
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45
    }
  }
}
```

---

## 4. –ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ –∏ –º–∞—Å—Ç–µ—Ä–æ–≤

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 4.1: –ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ**

**–®–∞–≥ 1: –í–≤–æ–¥ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: "–∫—É—Ö–Ω—è –ª–æ—Ñ—Ç"
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
GET /api/search?q=–∫—É—Ö–Ω—è%20–ª–æ—Ñ—Ç&type=video&page=1&limit=20
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/search.js:7

1. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ UTF-8 (–¥–ª—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã)
   const buffer = Buffer.from(query, 'latin1')
   const decoded = buffer.toString('utf8')

2. –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ
   SELECT v.*, u.username, u.avatar,
          COUNT(vl.id) as like_count,
          COUNT(vc.id) as comment_count
   FROM videos v
   LEFT JOIN users u ON v.author_id = u.id
   LEFT JOIN video_likes vl ON v.id = vl.video_id
   LEFT JOIN video_comments vc ON v.id = vc.video_id
   WHERE v.is_active = true AND v.is_public = true
     AND (
       v.title ILIKE '%–∫—É—Ö–Ω—è –ª–æ—Ñ—Ç%' 
       OR v.description ILIKE '%–∫—É—Ö–Ω—è –ª–æ—Ñ—Ç%'
       OR '–∫—É—Ö–Ω—è –ª–æ—Ñ—Ç' = ANY(v.tags)
     )
   GROUP BY v.id, u.id
   ORDER BY v.created_at DESC
   LIMIT 20

3. –ü–æ–¥—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   SELECT COUNT(DISTINCT v.id) FROM videos v WHERE ...
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "videos": [ /* –º–∞—Å—Å–∏–≤ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ */ ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 8,
      "pages": 1
    },
    "search": {
      "query": "–∫—É—Ö–Ω—è –ª–æ—Ñ—Ç",
      "type": "video",
      "category": null
    }
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 4.2: –ü–æ–∏—Å–∫ –º–∞—Å—Ç–µ—Ä–æ–≤**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
GET /api/search?q=–∏–≤–∞–Ω&type=channel&page=1&limit=20
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥ –∏—â–µ—Ç –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º**
```javascript
WHERE (
  u.username ILIKE '%–∏–≤–∞–Ω%'
  OR u.first_name ILIKE '%–∏–≤–∞–Ω%'
  OR u.last_name ILIKE '%–∏–≤–∞–Ω%'
)
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç —Å –≤–∏–¥–µ–æ –º–∞—Å—Ç–µ—Ä–æ–≤**
```json
{
  "success": true,
  "data": {
    "videos": [
      {
        "id": "1",
        "title": "–®–∫–∞—Ñ-–∫—É–ø–µ –Ω–∞ –∑–∞–∫–∞–∑",
        "author": {
          "id": "456",
          "username": "ivan_master",
          "first_name": "–ò–≤–∞–Ω",
          "last_name": "–ü–µ—Ç—Ä–æ–≤"
        }
      }
    ]
  }
}
```

---

## 5. –õ–∞–π–∫ –≤–∏–¥–µ–æ

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 5.1: –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫**

**–®–∞–≥ 1: –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –ª–∞–π–∫–∞**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç ‚ù§Ô∏è –Ω–∞ –≤–∏–¥–µ–æ
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å (toggle)**
```http
POST /api/videos/123/like
Authorization: Bearer <token>
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/videos.js:403

1. –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–∂–µ –ª–∞–π–∫–Ω—É—Ç–æ?
   SELECT * FROM video_likes WHERE video_id = '123' AND user_id = 'user_id'

2. –ï—Å–ª–∏ –ù–ï –ª–∞–π–∫–Ω—É—Ç–æ:
   INSERT INTO video_likes (video_id, user_id)
   VALUES ('123', 'user_id')
   
   UPDATE videos SET likes_count = likes_count + 1 WHERE id = '123'
   
   action = 'liked'

3. –ï—Å–ª–∏ –£–ñ–ï –ª–∞–π–∫–Ω—É—Ç–æ:
   DELETE FROM video_likes WHERE video_id = '123' AND user_id = 'user_id'
   
   UPDATE videos SET likes_count = likes_count - 1 WHERE id = '123'
   
   action = 'unliked'
```

**–®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
```javascript
// –ï—Å–ª–∏ action = 'liked':
INSERT INTO notifications (user_id, type, title, message, related_id)
VALUES (
  'author_id',  -- –∞–≤—Ç–æ—Ä –≤–∏–¥–µ–æ
  'like',
  '–ù–æ–≤—ã–π –ª–∞–π–∫',
  '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ivan_123 –ª–∞–π–∫–Ω—É–ª –≤–∞—à–µ –≤–∏–¥–µ–æ "–ö—É—Ö–Ω—è –ª–æ—Ñ—Ç"',
  '123'  -- video_id
)

// –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Socket.IO
io.to(`user_${author_id}`).emit('notification', notificationData)
```

**–®–∞–≥ 5: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "action": "liked",
    "likes_count": 43
  }
}
```

**–®–∞–≥ 6: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç UI**
```typescript
// –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
setIsLiked(true)
setLikesCount(prev => prev + 1)
```

---

## 6. –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 6.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è**

**–®–∞–≥ 1: –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª–æ?"
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/videos/123/comment
Authorization: Bearer <token>
Content-Type: application/json

{
  "content": "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª–æ?"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/videos.js:554

1. –í–∞–ª–∏–¥–∞—Ü–∏—è
   if (!content || content.trim().length === 0) {
     return 400 "Comment content is required"
   }

2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
   INSERT INTO video_comments (video_id, user_id, content)
   VALUES ('123', 'user_id', '–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞...')
   RETURNING *

3. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   SELECT username, avatar, first_name, last_name
   FROM users WHERE id = 'user_id'

4. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
   UPDATE videos SET comments_count = comments_count + 1 WHERE id = '123'
```

**–®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
```javascript
INSERT INTO notifications (user_id, type, title, message, related_id)
VALUES (
  'author_id',
  'comment',
  '–ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π',
  'ivan_123 –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª –≤–∞—à–µ –≤–∏–¥–µ–æ',
  '123'
)

// Socket.IO
io.to(`user_${author_id}`).emit('notification', {...})
```

**–®–∞–≥ 5: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "999",
    "video_id": "123",
    "user_id": "user_id",
    "content": "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª–æ?",
    "likes_count": 0,
    "created_at": "2024-01-15T12:00:00Z",
    "user": {
      "username": "ivan_123",
      "avatar": "/uploads/avatars/user_id.jpg",
      "first_name": "–ò–≤–∞–Ω"
    }
  }
}
```

---

## 7. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∑–∞–∫–ª–∞–¥–∫–∏

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 7.1: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–∫–ª–∞–¥–∫–∏**

**–®–∞–≥ 1: –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫–ª–∞–¥–∫–∏**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç üîñ
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å (toggle)**
```http
POST /api/videos/123/bookmark
Authorization: Bearer <token>
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/videos.js:969

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
   SELECT * FROM video_bookmarks 
   WHERE video_id = '123' AND user_id = 'user_id'

2. –ï—Å–ª–∏ –ù–ï –≤ –∑–∞–∫–ª–∞–¥–∫–∞—Ö:
   INSERT INTO video_bookmarks (video_id, user_id)
   VALUES ('123', 'user_id')
   action = 'bookmarked'

3. –ï—Å–ª–∏ –£–ñ–ï –≤ –∑–∞–∫–ª–∞–¥–∫–∞—Ö:
   DELETE FROM video_bookmarks 
   WHERE video_id = '123' AND user_id = 'user_id'
   action = 'unbookmarked'
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "action": "bookmarked"
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 7.2: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–ª–∞–¥–æ–∫**

**–®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–∫–ª–∞–¥–æ–∫**
```http
GET /api/videos/bookmarked?page=1&limit=20
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/videos.js:793

SELECT v.*, u.username, u.avatar,
       vb.created_at as bookmarked_at
FROM video_bookmarks vb
JOIN videos v ON vb.video_id = v.id
JOIN users u ON v.author_id = u.id
WHERE vb.user_id = 'user_id' AND v.is_active = true
ORDER BY vb.created_at DESC
LIMIT 20
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "videos": [ /* –∑–∞–∫–ª–∞–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */ ],
    "pagination": { ... }
  }
}
```

---

## 8. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–∞—Å—Ç–µ—Ä–∞

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 8.1: –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º–∞—Å—Ç–µ—Ä–∞**

**–®–∞–≥ 1: –ö–ª–∏–∫ "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è"**
```
–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–∞—Å—Ç–µ—Ä–∞ –∫–ª–∏–∫–∞–µ–º "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è"
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/users/456/subscribe
Authorization: Bearer <token>
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/users.js

1. –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω?
   SELECT * FROM subscriptions 
   WHERE subscriber_id = 'user_id' AND subscribed_to_id = '456'

2. –ï—Å–ª–∏ –ù–ï–¢:
   INSERT INTO subscriptions (subscriber_id, subscribed_to_id)
   VALUES ('user_id', '456')

3. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
   UPDATE users 
   SET subscribers_count = subscribers_count + 1 
   WHERE id = '456'

4. –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   INSERT INTO notifications (user_id, type, title, message)
   VALUES ('456', 'subscription', '–ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫', 'ivan_123 –ø–æ–¥–ø–∏—Å–∞–ª—Å—è')
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "subscribed": true,
    "subscribers_count": 150
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 8.2: –û—Ç–ø–∏—Å–∞—Ç—å—Å—è**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
DELETE /api/users/456/unsubscribe
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
DELETE FROM subscriptions 
WHERE subscriber_id = 'user_id' AND subscribed_to_id = '456'

UPDATE users 
SET subscribers_count = subscribers_count - 1 
WHERE id = '456'
```

---

## 9. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–∫–ª–∏–µ–Ω—Ç)

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 9.1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞**

**–®–∞–≥ 1: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã**
```
–ü–æ–ª—è:
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä –Ω–∞ –∑–∞–∫–∞–∑"
- –û–ø–∏—Å–∞–Ω–∏–µ: "–ù—É–∂–Ω–∞ –∫—É—Ö–Ω—è 3x4 –º–µ—Ç—Ä–∞..."
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: "kitchen"
- –ë—é–¥–∂–µ—Ç: 250000
- –°—Ä–æ–∫: "–¥–æ 2024-03-01"
- –§–æ—Ç–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/orders/create
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä –Ω–∞ –∑–∞–∫–∞–∑",
  "description": "–ù—É–∂–Ω–∞ –∫—É—Ö–Ω—è 3x4 –º–µ—Ç—Ä–∞ –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º...",
  "category": "kitchen",
  "budget": 250000,
  "deadline": "2024-03-01",
  "city": "–ê–ª–º–∞—Ç—ã",
  "address": "—É–ª. –ê–±–∞—è, 150"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/orders.js

1. –í–∞–ª–∏–¥–∞—Ü–∏—è
   if (!title || !description || !budget) {
     return 400 "Missing required fields"
   }

2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
   INSERT INTO orders (
     client_id, title, description, category, 
     budget, deadline, city, address, status
   )
   VALUES (
     'user_id', '–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä...', '...', 'kitchen',
     250000, '2024-03-01', '–ê–ª–º–∞—Ç—ã', '—É–ª. –ê–±–∞—è, 150', 'open'
   )
   RETURNING *

3. –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–æ—Ç–æ:
   INSERT INTO order_photos (order_id, photo_url)
   VALUES ('order_id', '/uploads/orders/photo-123.jpg')
```

**–®–∞–≥ 4: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞–º**
```javascript
// –ù–∞–π—Ç–∏ –º–∞—Å—Ç–µ—Ä–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "kitchen"
SELECT id FROM users 
WHERE role = 'master' 
  AND 'kitchen' = ANY(categories)
  AND is_active = true

// –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
FOR EACH master:
  INSERT INTO notifications (user_id, type, title, message, related_id)
  VALUES (
    master.id,
    'new_order',
    '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –≤ –≤–∞—à–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
    '–ö–ª–∏–µ–Ω—Ç ivan_123 —Å–æ–∑–¥–∞–ª –∑–∞–∫–∞–∑ "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä"',
    'order_id'
  )
  
  // Socket.IO
  io.to(`user_${master.id}`).emit('notification', {...})
```

**–®–∞–≥ 5: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "order_123",
    "client_id": "user_id",
    "title": "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä –Ω–∞ –∑–∞–∫–∞–∑",
    "description": "–ù—É–∂–Ω–∞ –∫—É—Ö–Ω—è 3x4 –º–µ—Ç—Ä–∞...",
    "category": "kitchen",
    "budget": 250000,
    "deadline": "2024-03-01",
    "city": "–ê–ª–º–∞—Ç—ã",
    "status": "open",
    "responses_count": 0,
    "created_at": "2024-01-15T13:00:00Z"
  }
}
```

---

## 10. –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 10.1: –õ–µ–Ω—Ç–∞ –∑–∞–∫–∞–∑–æ–≤**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
GET /api/orders/feed?page=1&limit=20&category=kitchen&status=open
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/orders.js

SELECT o.*, u.username, u.avatar, u.first_name,
       COUNT(or.id) as responses_count
FROM orders o
LEFT JOIN users u ON o.client_id = u.id
LEFT JOIN order_responses or ON o.id = or.order_id
WHERE o.is_active = true
  AND o.status = 'open'
  AND o.category = 'kitchen'
GROUP BY o.id, u.id
ORDER BY o.created_at DESC
LIMIT 20
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "orders": [
      {
        "id": "order_123",
        "title": "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä",
        "budget": 250000,
        "deadline": "2024-03-01",
        "city": "–ê–ª–º–∞—Ç—ã",
        "status": "open",
        "responses_count": 3,
        "client": {
          "username": "ivan_123",
          "avatar": "/uploads/avatars/user.jpg"
        }
      }
    ],
    "pagination": { ... }
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 10.2: –ú–æ–∏ –∑–∞–∫–∞–∑—ã (–∫–ª–∏–µ–Ω—Ç)**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
GET /api/orders/feed?client_id=user_id
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ client_id**
```javascript
WHERE o.client_id = 'user_id'
```

---

## 11. –û—Ç–∫–ª–∏–∫ –Ω–∞ –∑–∞–∫–∞–∑ (–º–∞—Å—Ç–µ—Ä)

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 11.1: –ú–∞—Å—Ç–µ—Ä –æ—Ç–∫–ª–∏–∫–∞–µ—Ç—Å—è**

**–®–∞–≥ 1: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–∞**
```
–ú–∞—Å—Ç–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑ "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä"
```

**–®–∞–≥ 2: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –æ—Ç–∫–ª–∏–∫–∞**
```
–ü–æ–ª—è:
- –°–æ–æ–±—â–µ–Ω–∏–µ: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ó–∞–Ω–∏–º–∞—é—Å—å –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ–º –∫—É—Ö–æ–Ω—å 10 –ª–µ—Ç..."
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞: 230000
- –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: "20 –¥–Ω–µ–π"
- –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ (—Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ)
```

**–®–∞–≥ 3: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/orders/order_123/response
Authorization: Bearer <token>
Content-Type: application/json

{
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ó–∞–Ω–∏–º–∞—é—Å—å –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ–º –∫—É—Ö–æ–Ω—å 10 –ª–µ—Ç...",
  "proposedPrice": 230000,
  "estimatedDays": 20,
  "portfolioVideos": ["video_1", "video_2"]
}
```

**–®–∞–≥ 4: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/orders.js

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏
   if (user.role !== 'master') {
     return 403 "Only masters can respond"
   }

2. –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–∂–µ –æ—Ç–∫–ª–∏–∫–Ω—É–ª—Å—è?
   SELECT * FROM order_responses 
   WHERE order_id = 'order_123' AND master_id = 'user_id'
   
   –ï—Å–ª–∏ –î–ê ‚Üí 400 "Already responded"

3. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞
   INSERT INTO order_responses (
     order_id, master_id, message, 
     proposed_price, estimated_days, status
   )
   VALUES (
     'order_123', 'user_id', '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!...',
     230000, 20, 'pending'
   )

4. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –æ—Ç–∫–ª–∏–∫–æ–≤
   UPDATE orders 
   SET responses_count = responses_count + 1 
   WHERE id = 'order_123'
```

**–®–∞–≥ 5: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É**
```javascript
INSERT INTO notifications (user_id, type, title, message, related_id)
VALUES (
  'client_id',
  'order_response',
  '–ù–æ–≤—ã–π –æ—Ç–∫–ª–∏–∫ –Ω–∞ –∑–∞–∫–∞–∑',
  '–ú–∞—Å—Ç–µ—Ä ivan_master –æ—Ç–∫–ª–∏–∫–Ω—É–ª—Å—è –Ω–∞ "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä"',
  'order_123'
)

io.to(`user_${client_id}`).emit('notification', {...})
```

**–®–∞–≥ 6: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "response_456",
    "order_id": "order_123",
    "master_id": "user_id",
    "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!...",
    "proposed_price": 230000,
    "estimated_days": 20,
    "status": "pending",
    "created_at": "2024-01-15T14:00:00Z"
  }
}
```

---

## 12. –ü—Ä–∏–Ω—è—Ç–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞ (–∫–ª–∏–µ–Ω—Ç)

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 12.1: –ü—Ä–∏–Ω—è—Ç–∏–µ –æ—Ç–∫–ª–∏–∫–∞**

**–®–∞–≥ 1: –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–∫–ª–∏–∫–æ–≤**
```http
GET /api/orders/order_123
Authorization: Bearer <token>
```

–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç –º–∞—Å—Å–∏–≤ –æ—Ç–∫–ª–∏–∫–æ–≤:
```json
{
  "order": { ... },
  "responses": [
    {
      "id": "response_456",
      "master": {
        "id": "master_id",
        "username": "ivan_master",
        "rating": 4.8,
        "completed_orders": 45
      },
      "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!...",
      "proposed_price": 230000,
      "status": "pending"
    }
  ]
}
```

**–®–∞–≥ 2: –ü—Ä–∏–Ω—è—Ç–∏–µ –æ—Ç–∫–ª–∏–∫–∞**
```http
POST /api/orders/order_123/accept
Authorization: Bearer <token>
Content-Type: application/json

{
  "responseId": "response_456"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
   if (order.client_id !== user.id) {
     return 403 "Not your order"
   }

2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞
   UPDATE order_responses 
   SET status = 'accepted' 
   WHERE id = 'response_456'

3. –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ—Ç–∫–ª–∏–∫–æ–≤
   UPDATE order_responses 
   SET status = 'rejected' 
   WHERE order_id = 'order_123' AND id != 'response_456'

4. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
   UPDATE orders 
   SET status = 'in_progress', master_id = 'master_id' 
   WHERE id = 'order_123'

5. –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ –º–∞—Å—Ç–µ—Ä–æ–º
   INSERT INTO chats (created_by, type)
   VALUES ('client_id', 'private')
   
   INSERT INTO chat_participants (chat_id, user_id)
   VALUES ('chat_id', 'client_id'), ('chat_id', 'master_id')
```

**–®–∞–≥ 4: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
```javascript
// –ú–∞—Å—Ç–µ—Ä—É (–ø—Ä–∏–Ω—è—Ç—ã–π)
INSERT INTO notifications (user_id, type, title, message)
VALUES (
  'master_id',
  'order_accepted',
  '–í–∞—à –æ—Ç–∫–ª–∏–∫ –ø—Ä–∏–Ω—è—Ç!',
  '–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω—è–ª –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∑–∞–∫–∞–∑ "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä"'
)

// –û—Å—Ç–∞–ª—å–Ω—ã–º –º–∞—Å—Ç–µ—Ä–∞–º
FOR EACH rejected_response:
  INSERT INTO notifications (user_id, type, title, message)
  VALUES (
    rejected_master_id,
    'order_rejected',
    '–û—Ç–∫–ª–∏–∫ –æ—Ç–∫–ª–æ–Ω—ë–Ω',
    '–ö–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞'
  )
```

**–®–∞–≥ 5: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "order": {
      "id": "order_123",
      "status": "in_progress",
      "master_id": "master_id"
    },
    "chat": {
      "id": "chat_789",
      "participants": ["client_id", "master_id"]
    }
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 12.2: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/orders/order_123/reject
Authorization: Bearer <token>
Content-Type: application/json

{
  "responseId": "response_456"
}
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
UPDATE order_responses 
SET status = 'rejected' 
WHERE id = 'response_456'
```

---

## 13. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 13.1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞**

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- `open` - –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –æ—Ç–∫–ª–∏–∫–æ–≤
- `in_progress` - –≤ —Ä–∞–±–æ—Ç–µ
- `completed` - –≤—ã–ø–æ–ª–Ω–µ–Ω
- `cancelled` - –æ—Ç–º–µ–Ω—ë–Ω

**–®–∞–≥ 1: –ú–∞—Å—Ç–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É**
```http
PUT /api/orders/order_123/status
Authorization: Bearer <token>
Content-Type: application/json

{
  "status": "completed"
}
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/orders.js

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
   if (order.master_id !== user.id && order.client_id !== user.id) {
     return 403 "Forbidden"
   }

2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
   const allowedStatuses = ['in_progress', 'completed', 'cancelled']
   if (!allowedStatuses.includes(status)) {
     return 400 "Invalid status"
   }

3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   UPDATE orders 
   SET status = 'completed', completed_at = NOW() 
   WHERE id = 'order_123'

4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–∞—Å—Ç–µ—Ä–∞
   UPDATE users 
   SET completed_orders = completed_orders + 1 
   WHERE id = 'master_id'
```

**–®–∞–≥ 3: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É**
```javascript
INSERT INTO notifications (user_id, type, title, message)
VALUES (
  'client_id',
  'order_completed',
  '–ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω',
  '–ú–∞—Å—Ç–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –∑–∞–∫–∞–∑–æ–º "–ö—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä"'
)
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "order_123",
    "status": "completed",
    "completed_at": "2024-02-15T10:00:00Z"
  }
}
```

---

## 14. –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 14.1: –ù–∞—á–∞—Ç—å —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º**

**–®–∞–≥ 1: –ö–ª–∏–∫ "–ù–∞–ø–∏—Å–∞—Ç—å" –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–µ –º–∞—Å—Ç–µ—Ä–∞**
```
–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–∞—Å—Ç–µ—Ä–∞ –∫–ª–∏–∫–∞–µ–º "–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"
```

**–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —á–∞—Ç–∞**
```http
GET /api/chat/list
Authorization: Bearer <token>
```

```javascript
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
const existingChat = chats.find(chat => 
  chat.participants.some(p => p.id === master_id)
)

if (existingChat) {
  // –û—Ç–∫—Ä—ã—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —á–∞—Ç
  navigate(`/chat/${existingChat.id}`)
} else {
  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
}
```

**–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞**
```http
POST /api/chat/create-with-user
Authorization: Bearer <token>
Content-Type: application/json

{
  "userId": "master_id"
}
```

**–®–∞–≥ 4: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/chat.js

1. –ü—Ä–æ–≤–µ—Ä–∫–∞: —á–∞—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
   SELECT c.id FROM chats c
   JOIN chat_participants cp1 ON c.id = cp1.chat_id AND cp1.user_id = 'user_id'
   JOIN chat_participants cp2 ON c.id = cp2.chat_id AND cp2.user_id = 'master_id'
   WHERE c.type = 'private'

2. –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –≤–µ—Ä–Ω—É—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

3. –ï—Å–ª–∏ –ù–ï–¢:
   INSERT INTO chats (created_by, type)
   VALUES ('user_id', 'private')
   RETURNING id

4. –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
   INSERT INTO chat_participants (chat_id, user_id)
   VALUES ('chat_id', 'user_id'), ('chat_id', 'master_id')
```

**–®–∞–≥ 5: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "chat_789",
    "type": "private",
    "participants": [
      {
        "id": "user_id",
        "username": "ivan_123",
        "avatar": "/uploads/avatars/user.jpg"
      },
      {
        "id": "master_id",
        "username": "master_ivan",
        "avatar": "/uploads/avatars/master.jpg"
      }
    ],
    "created_at": "2024-01-15T15:00:00Z"
  }
}
```

---

## 15. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 15.1: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è**

**–®–∞–≥ 1: –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–æ–≥–¥–∞ —Å–º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É?"
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/chat/chat_789/message
Authorization: Bearer <token>
Content-Type: application/json

{
  "content": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–æ–≥–¥–∞ —Å–º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É?"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/chat.js

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–∏—è –≤ —á–∞—Ç–µ
   SELECT * FROM chat_participants 
   WHERE chat_id = 'chat_789' AND user_id = 'user_id'
   
   –ï—Å–ª–∏ –ù–ï–¢ ‚Üí 403 "Not a participant"

2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   INSERT INTO chat_messages (chat_id, sender_id, content, type)
   VALUES ('chat_789', 'user_id', '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!...', 'text')
   RETURNING *

3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
   UPDATE chats 
   SET last_message_at = NOW() 
   WHERE id = 'chat_789'

4. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
   SELECT username, avatar FROM users WHERE id = 'user_id'
```

**–®–∞–≥ 4: Socket.IO broadcast**
```javascript
// –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —á–∞—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
const participants = await getParticipants('chat_789')

participants.forEach(participant => {
  io.to(`user_${participant.id}`).emit('message', {
    chatId: 'chat_789',
    message: {
      id: 'msg_123',
      content: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!...',
      sender: {
        id: 'user_id',
        username: 'ivan_123'
      },
      createdAt: '2024-01-15T15:05:00Z'
    }
  })
})
```

**–®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
```javascript
// –¢–æ–ª—å–∫–æ –¥–ª—è –ù–ï –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
INSERT INTO notifications (user_id, type, title, message, related_id)
VALUES (
  'master_id',
  'chat_message',
  '–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
  'ivan_123: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–æ–≥–¥–∞ —Å–º–æ–∂–µ—Ç–µ...',
  'chat_789'
)
```

**–®–∞–≥ 6: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "msg_123",
    "chat_id": "chat_789",
    "sender_id": "user_id",
    "content": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–æ–≥–¥–∞ —Å–º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É?",
    "type": "text",
    "created_at": "2024-01-15T15:05:00Z",
    "sender": {
      "username": "ivan_123",
      "avatar": "/uploads/avatars/user.jpg"
    }
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 15.2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞**

**–®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞**
```http
GET /api/chat/chat_789/messages?page=1&limit=50
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
SELECT cm.*, u.username, u.avatar
FROM chat_messages cm
LEFT JOIN users u ON cm.sender_id = u.id
WHERE cm.chat_id = 'chat_789'
ORDER BY cm.created_at DESC
LIMIT 50
```

**–®–∞–≥ 3: –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ**
```http
POST /api/chat/chat_789/read
Authorization: Bearer <token>
```

```javascript
UPDATE chat_messages 
SET is_read = true 
WHERE chat_id = 'chat_789' 
  AND sender_id != 'user_id'
  AND is_read = false
```

---

## 16. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —á–∞—Ç

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 16.1: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ/—Ñ–∞–π–ª–∞**

**–®–∞–≥ 1: –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç —Ñ–æ—Ç–æ —Ä–∞–∑–º–µ—Ä–æ–º 3MB: "kitchen_sketch.jpg"
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/chat/chat_789/message
Authorization: Bearer <token>
Content-Type: multipart/form-data

file: [binary data]
content: "–í–æ—Ç –ø—Ä–∏–º–µ—Ä–Ω—ã–π —ç—Å–∫–∏–∑ –∫—É—Ö–Ω–∏"
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// Multer –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É
1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
   const filename = `chat-${Date.now()}-${Math.random()}.jpg`
   fs.writeFile(`/app/uploads/chat/${filename}`, file.buffer)

2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   INSERT INTO chat_messages (
     chat_id, sender_id, content, type,
     file_path, file_name, file_size, file_type
   )
   VALUES (
     'chat_789', 'user_id', '–í–æ—Ç –ø—Ä–∏–º–µ—Ä–Ω—ã–π —ç—Å–∫–∏–∑...', 'image',
     '/uploads/chat/chat-123456.jpg', 'kitchen_sketch.jpg', 3145728, 'image/jpeg'
   )
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "msg_124",
    "content": "–í–æ—Ç –ø—Ä–∏–º–µ—Ä–Ω—ã–π —ç—Å–∫–∏–∑ –∫—É—Ö–Ω–∏",
    "type": "image",
    "file_path": "/uploads/chat/chat-123456.jpg",
    "file_name": "kitchen_sketch.jpg",
    "file_size": 3145728
  }
}
```

---

## 17. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ (–º–∞—Å—Ç–µ—Ä)

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 17.1: –ú–∞—Å—Ç–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ**

**–®–∞–≥ 1: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã**
```
–ü–æ–ª—è:
- –í–∏–¥–µ–æ —Ñ–∞–π–ª: kitchen_project.mp4 (45MB)
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º"
- –û–ø–∏—Å–∞–Ω–∏–µ: "–ü—Ä–æ–µ–∫—Ç –∫—É—Ö–Ω–∏ –ø–ª–æ—â–∞–¥—å—é 12 –∫–≤.–º..."
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: kitchen
- –¢–µ–≥–∏: –º–∏–Ω–∏–º–∞–ª–∏–∑–º, –±–µ–ª–∞—è –∫—É—Ö–Ω—è, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
- –¶–µ–Ω–∞ –º–µ–±–µ–ª–∏: 280000
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/videos/upload
Authorization: Bearer <token>
Content-Type: multipart/form-data

video: [binary data 45MB]
title: "–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º"
description: "–ü—Ä–æ–µ–∫—Ç –∫—É—Ö–Ω–∏ –ø–ª–æ—â–∞–¥—å—é 12 –∫–≤.–º..."
category: "kitchen"
tags: "–º–∏–Ω–∏–º–∞–ª–∏–∑–º,–±–µ–ª–∞—è –∫—É—Ö–Ω—è,–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞"
furniturePrice: 280000
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∞**
```javascript
// current-server/routes/videos.js:37

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏
   if (user.role !== 'master' && user.role !== 'admin') {
     return 403 "Only masters can upload"
   }

2. Multer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª
   const filename = `video-${Date.now()}-${Math.random()}.mp4`
   ‚Üí /app/uploads/videos/video-1234567890-123.mp4

3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
   INSERT INTO videos (
     title, description, video_url, author_id,
     category, tags, furniture_price, file_size,
     is_active, is_public
   )
   VALUES (
     '–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º',
     '–ü—Ä–æ–µ–∫—Ç –∫—É—Ö–Ω–∏...',
     '/uploads/videos/video-1234567890-123.mp4',
     'user_id',
     'kitchen',
     ARRAY['–º–∏–Ω–∏–º–∞–ª–∏–∑–º', '–±–µ–ª–∞—è –∫—É—Ö–Ω—è', '–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞'],
     280000,
     47185920,
     true,
     true
   )
   RETURNING id

4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é
   videoService.generateThumbnail(filePath, videoId)
```

**–®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é**
```javascript
// current-server/services/videoService.js

const ffmpeg = require('fluent-ffmpeg')

// –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–≤—å—é –Ω–∞ 1-–π —Å–µ–∫—É–Ω–¥–µ
ffmpeg(videoPath)
  .screenshots({
    count: 1,
    timemarks: ['1'],
    filename: `thumb-${videoId}.jpg`,
    folder: '/app/uploads/thumbnails'
  })
  .on('end', () => {
    // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
    UPDATE videos 
    SET thumbnail_url = `/uploads/thumbnails/thumb-${videoId}.jpg`
    WHERE id = videoId
  })
```

**–®–∞–≥ 5: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```javascript
// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
ffmpeg.ffprobe(videoPath, (err, metadata) => {
  const duration = Math.floor(metadata.format.duration)
  
  UPDATE videos 
  SET duration = duration
  WHERE id = videoId
})
```

**–®–∞–≥ 6: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ (fast start)**
```javascript
// –î–ª—è –≤–µ–±-–ø–ª–µ–µ—Ä–∞
ffmpeg(videoPath)
  .outputOptions('-movflags', 'faststart')
  .save(optimizedPath)
```

**–®–∞–≥ 7: –û—Ç–≤–µ—Ç (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥—ë—Ç –≤ —Ñ–æ–Ω–µ)**
```json
{
  "success": true,
  "data": {
    "id": "video_999",
    "title": "–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º",
    "video_url": "/uploads/videos/video-1234567890-123.mp4",
    "thumbnail_url": null,  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è...
    "duration": 0,  // –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è...
    "category": "kitchen",
    "tags": ["–º–∏–Ω–∏–º–∞–ª–∏–∑–º", "–±–µ–ª–∞—è –∫—É—Ö–Ω—è", "–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞"],
    "furniture_price": 280000,
    "created_at": "2024-01-15T16:00:00Z"
  },
  "message": "Video uploaded successfully. Thumbnail and duration are being processed."
}
```

**–®–∞–≥ 8: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º**
```javascript
// –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –º–∞—Å—Ç–µ—Ä–∞
SELECT subscriber_id FROM subscriptions 
WHERE subscribed_to_id = 'user_id'

// –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
FOR EACH subscriber:
  INSERT INTO notifications (user_id, type, title, message, related_id)
  VALUES (
    subscriber.id,
    'new_video',
    '–ù–æ–≤–æ–µ –≤–∏–¥–µ–æ –æ—Ç –º–∞—Å—Ç–µ—Ä–∞',
    'master_ivan –∑–∞–≥—Ä—É–∑–∏–ª –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ "–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º"',
    'video_999'
  )
  
  // Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  sendPushNotification(subscriber.id, {...})
```

---

## 18. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–µ–æ

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 18.1: –ú–∞—Å—Ç–µ—Ä —Å–º–æ—Ç—Ä–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å —Å–≤–æ–µ–≥–æ –≤–∏–¥–µ–æ**
```http
GET /api/videos/video_999
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä)**
```javascript
// –ë—ç–∫–µ–Ω–¥ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∞–≤—Ç–æ—Ä–∞

if (video.author_id === user.id) {
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –ø–æ –¥–Ω—è–º
  SELECT DATE(watched_at) as date, COUNT(*) as views
  FROM video_views
  WHERE video_id = 'video_999'
  GROUP BY DATE(watched_at)
  ORDER BY date DESC
  LIMIT 30

  // –¢–æ–ø –∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–æ–≤
  SELECT u.username, COUNT(*) as comments_count
  FROM video_comments vc
  JOIN users u ON vc.user_id = u.id
  WHERE vc.video_id = 'video_999'
  GROUP BY u.id, u.username
  ORDER BY comments_count DESC
  LIMIT 10

  // –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
  SELECT city, COUNT(*) as views
  FROM video_views vv
  JOIN users u ON vv.user_id = u.id
  WHERE vv.video_id = 'video_999' AND u.city IS NOT NULL
  GROUP BY city
  ORDER BY views DESC
}
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π**
```json
{
  "success": true,
  "data": {
    "id": "video_999",
    "title": "–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º",
    "views_count": 1250,
    "likes_count": 87,
    "comments_count": 23,
    "bookmarks_count": 34,
    "shares_count": 12,
    "statistics": {
      "viewsByDate": [
        { "date": "2024-01-15", "views": 45 },
        { "date": "2024-01-14", "views": 78 }
      ],
      "topCommenters": [
        { "username": "anna_designer", "comments": 3 }
      ],
      "viewsByCity": [
        { "city": "–ê–ª–º–∞—Ç—ã", "views": 450 },
        { "city": "–ê—Å—Ç–∞–Ω–∞", "views": 320 }
      ]
    }
  }
}
```

---

## 19. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 19.1: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
GET /api/auth/profile
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/auth.js

SELECT u.*, 
       COUNT(DISTINCT s.id) as subscribers_count,
       COUNT(DISTINCT sub.id) as subscriptions_count,
       COUNT(DISTINCT v.id) as videos_count,
       COUNT(DISTINCT vl.id) as likes_received
FROM users u
LEFT JOIN subscriptions s ON u.id = s.subscribed_to_id
LEFT JOIN subscriptions sub ON u.id = sub.subscriber_id
LEFT JOIN videos v ON u.id = v.author_id
LEFT JOIN video_likes vl ON v.id = vl.video_id
WHERE u.id = 'user_id'
GROUP BY u.id
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "user_id",
    "email": "ivan@example.com",
    "username": "ivan_123",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "phone": "+77001234567",
    "avatar": "/uploads/avatars/user_id.jpg",
    "role": "client",
    "city": "–ê–ª–º–∞—Ç—ã",
    "bio": "–õ—é–±–ª—é –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –º–µ–±–µ–ª—å",
    "subscribers_count": 0,
    "subscriptions_count": 15,
    "videos_count": 0,
    "likes_received": 0,
    "created_at": "2024-01-01T10:00:00Z"
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 19.2: –ü—Ä–æ—Å–º–æ—Ç—Ä —á—É–∂–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
GET /api/users/master_id
Authorization: Bearer <token>  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/users.js

SELECT u.*, 
       COUNT(DISTINCT s.id) as subscribers_count,
       COUNT(DISTINCT v.id) as videos_count,
       AVG(r.rating) as average_rating,
       COUNT(DISTINCT o.id) as completed_orders
FROM users u
LEFT JOIN subscriptions s ON u.id = s.subscribed_to_id
LEFT JOIN videos v ON u.id = v.author_id
LEFT JOIN reviews r ON u.id = r.master_id
LEFT JOIN orders o ON u.id = o.master_id AND o.status = 'completed'
WHERE u.id = 'master_id'
GROUP BY u.id

// –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
if (currentUser) {
  SELECT * FROM subscriptions 
  WHERE subscriber_id = 'user_id' AND subscribed_to_id = 'master_id'
}
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "master_id",
    "username": "ivan_master",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ü–µ—Ç—Ä–æ–≤",
    "avatar": "/uploads/avatars/master_id.jpg",
    "role": "master",
    "city": "–ê–ª–º–∞—Ç—ã",
    "bio": "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–±–µ–ª—å—â–∏–∫. 10 –ª–µ—Ç –æ–ø—ã—Ç–∞.",
    "subscribers_count": 1250,
    "videos_count": 45,
    "average_rating": 4.8,
    "completed_orders": 67,
    "is_subscribed": false,  // –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    "categories": ["kitchen", "wardrobe", "living_room"]
  }
}
```

---

## 20. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 20.1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è**

**–®–∞–≥ 1: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã**
```
–ò–∑–º–µ–Ω—è–µ–º—ã–µ –ø–æ–ª—è:
- –ò–º—è: "–ò–≤–∞–Ω"
- –§–∞–º–∏–ª–∏—è: "–ò–≤–∞–Ω–æ–≤"
- –¢–µ–ª–µ—Ñ–æ–Ω: "+77001234567"
- –ì–æ—Ä–æ–¥: "–ê–ª–º–∞—Ç—ã"
- –ë–∏–æ: "–¶–µ–Ω—é –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–∏–ª—å"
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
PUT /api/auth/profile
Authorization: Bearer <token>
Content-Type: application/json

{
  "firstName": "–ò–≤–∞–Ω",
  "lastName": "–ò–≤–∞–Ω–æ–≤",
  "phone": "+77001234567",
  "city": "–ê–ª–º–∞—Ç—ã",
  "bio": "–¶–µ–Ω—é –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–∏–ª—å"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/auth.js

UPDATE users 
SET 
  first_name = '–ò–≤–∞–Ω',
  last_name = '–ò–≤–∞–Ω–æ–≤',
  phone = '+77001234567',
  city = '–ê–ª–º–∞—Ç—ã',
  bio = '–¶–µ–Ω—é –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–∏–ª—å',
  updated_at = NOW()
WHERE id = 'user_id'
RETURNING *
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "id": "user_id",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "phone": "+77001234567",
    "city": "–ê–ª–º–∞—Ç—ã",
    "bio": "–¶–µ–Ω—é –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–∏–ª—å",
    "updated_at": "2024-01-15T17:00:00Z"
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 20.2: –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞**

**–®–∞–≥ 1: –í—ã–±–æ—Ä —Ñ–æ—Ç–æ**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª: avatar.jpg (2MB)
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
PUT /api/auth/profile
Authorization: Bearer <token>
Content-Type: multipart/form-data

avatar: [binary data]
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
1. Multer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª
   const filename = `avatar-${user.id}-${Date.now()}.jpg`
   ‚Üí /app/uploads/avatars/avatar-user_id-1234567890.jpg

2. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ (–µ—Å–ª–∏ –±—ã–ª)
   if (user.avatar && user.avatar !== '/default-avatar.png') {
     fs.unlink(user.avatar)
   }

3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
   UPDATE users 
   SET avatar = '/uploads/avatars/avatar-user_id-1234567890.jpg'
   WHERE id = 'user_id'
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "avatar": "/uploads/avatars/avatar-user_id-1234567890.jpg"
  }
}
```

---

## 21. –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–Ω–∞–ª–∞ –º–∞—Å—Ç–µ—Ä–∞

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 21.1: –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–∞ –º–∞—Å—Ç–µ—Ä–∞**

**–®–∞–≥ 1: –ö–ª–∏–∫ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å –º–∞—Å—Ç–µ—Ä–∞**
```
–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É: /master/master_id
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
GET /api/videos/master/master_id?page=1&limit=20
Authorization: Bearer <token>  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/videos.js:287

1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Å—Ç–µ—Ä–µ
   SELECT u.*, 
          COUNT(DISTINCT s.id) as subscribers_count,
          COUNT(DISTINCT v.id) as videos_count,
          SUM(vv.views) as total_views
   FROM users u
   LEFT JOIN subscriptions s ON u.id = s.subscribed_to_id
   LEFT JOIN videos v ON u.id = v.author_id
   LEFT JOIN (
     SELECT video_id, COUNT(*) as views 
     FROM video_views 
     GROUP BY video_id
   ) vv ON v.id = vv.video_id
   WHERE u.id = 'master_id' AND u.role = 'master'
   GROUP BY u.id

2. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ –º–∞—Å—Ç–µ—Ä–∞
   SELECT v.*, 
          COUNT(DISTINCT vl.id) as likes_count,
          COUNT(DISTINCT vc.id) as comments_count,
          COUNT(DISTINCT vv.id) as views_count
   FROM videos v
   LEFT JOIN video_likes vl ON v.id = vl.video_id
   LEFT JOIN video_comments vc ON v.id = vc.video_id
   LEFT JOIN video_views vv ON v.id = vv.video_id
   WHERE v.author_id = 'master_id' 
     AND v.is_active = true 
     AND v.is_public = true
   GROUP BY v.id
   ORDER BY v.created_at DESC
   LIMIT 20

3. –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
   SELECT * FROM subscriptions 
   WHERE subscriber_id = 'user_id' AND subscribed_to_id = 'master_id'
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "master": {
      "id": "master_id",
      "username": "ivan_master",
      "first_name": "–ò–≤–∞–Ω",
      "last_name": "–ü–µ—Ç—Ä–æ–≤",
      "avatar": "/uploads/avatars/master_id.jpg",
      "bio": "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–±–µ–ª—å—â–∏–∫",
      "subscribers_count": 1250,
      "videos_count": 45,
      "total_views": 125000,
      "is_subscribed": false
    },
    "videos": [
      {
        "id": "video_1",
        "title": "–ö—É—Ö–Ω—è –≤ —Å—Ç–∏–ª–µ –ª–æ—Ñ—Ç",
        "thumbnail_url": "/uploads/thumbnails/thumb-1.jpg",
        "duration": 180,
        "likes_count": 87,
        "comments_count": 23,
        "views_count": 1250,
        "created_at": "2024-01-15T10:00:00Z"
      }
      // ... –µ—â—ë 19 –≤–∏–¥–µ–æ
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45,
      "pages": 3
    }
  }
}
```

---

## 22. –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 22.1: –ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**

**–®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–∞–∑–¥–µ–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
```http
GET /api/notifications?page=1&limit=20
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/notifications.js

SELECT n.*, 
       u.username as actor_username, 
       u.avatar as actor_avatar
FROM notifications n
LEFT JOIN users u ON n.actor_id = u.id
WHERE n.user_id = 'user_id'
ORDER BY n.created_at DESC
LIMIT 20
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "notifications": [
      {
        "id": "notif_1",
        "type": "like",
        "title": "–ù–æ–≤—ã–π –ª–∞–π–∫",
        "message": "anna_designer –ª–∞–π–∫–Ω—É–ª–∞ –≤–∞—à–µ –≤–∏–¥–µ–æ \"–ö—É—Ö–Ω—è –ª–æ—Ñ—Ç\"",
        "related_id": "video_123",
        "is_read": false,
        "created_at": "2024-01-15T18:00:00Z",
        "actor": {
          "username": "anna_designer",
          "avatar": "/uploads/avatars/anna.jpg"
        }
      },
      {
        "id": "notif_2",
        "type": "comment",
        "title": "–ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
        "message": "ivan_123: –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!",
        "related_id": "video_123",
        "is_read": false,
        "created_at": "2024-01-15T17:30:00Z"
      },
      {
        "id": "notif_3",
        "type": "order_response",
        "title": "–ù–æ–≤—ã–π –æ—Ç–∫–ª–∏–∫",
        "message": "–ú–∞—Å—Ç–µ—Ä –æ—Ç–∫–ª–∏–∫–Ω—É–ª—Å—è –Ω–∞ –≤–∞—à –∑–∞–∫–∞–∑",
        "related_id": "order_123",
        "is_read": true,
        "created_at": "2024-01-15T14:00:00Z"
      }
    ],
    "unread_count": 15,
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 87
    }
  }
}
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 22.2: –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ**

**–®–∞–≥ 1: –ö–ª–∏–∫ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**
```http
POST /api/notifications/notif_1/read
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
UPDATE notifications 
SET is_read = true 
WHERE id = 'notif_1' AND user_id = 'user_id'
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 22.3: –ü–æ–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ**

**–®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/notifications/read-all
Authorization: Bearer <token>
```

**–®–∞–≥ 2: –ë—ç–∫–µ–Ω–¥**
```javascript
UPDATE notifications 
SET is_read = true 
WHERE user_id = 'user_id' AND is_read = false
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 22.4: Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Socket.IO**

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Socket.IO:**
```typescript
// client/src/services/socketService.ts

const socket = io('https://mebelplace.store', {
  auth: {
    token: localStorage.getItem('accessToken')
  }
})

// –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
socket.emit('join', `user_${userId}`)

// –°–ª—É—à–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
socket.on('notification', (notification) => {
  // –ü–æ–∫–∞–∑–∞—Ç—å toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  showToast(notification.title, notification.message)
  
  // –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
  setUnreadCount(prev => prev + 1)
  
  // –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  setNotifications(prev => [notification, ...prev])
})
```

---

## 23. Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 23.1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è push**

**–®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –æ—Ç Firebase/APNS**
```typescript
// Mobile app
const pushToken = await Notifications.getExpoPushTokenAsync()
```

**–®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥**
```http
POST /api/push/register
Authorization: Bearer <token>
Content-Type: application/json

{
  "pushToken": "ExponentPushToken[xxxxxxxxxxxxxx]",
  "deviceType": "ios",
  "deviceId": "unique-device-id"
}
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç**
```javascript
// current-server/routes/push.js

INSERT INTO push_tokens (user_id, token, device_type, device_id)
VALUES ('user_id', 'ExponentPushToken[xxx]', 'ios', 'device-id')
ON CONFLICT (device_id) 
DO UPDATE SET token = EXCLUDED.token, updated_at = NOW()
```

---

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 23.2: –û—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –ù–æ–≤—ã–π –ª–∞–π–∫
- –ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
- –ù–æ–≤—ã–π –æ—Ç–∫–ª–∏–∫ –Ω–∞ –∑–∞–∫–∞–∑
- –ù–æ–≤–æ–µ –≤–∏–¥–µ–æ –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏

**–ü—Ä–æ—Ü–µ—Å—Å:**
```javascript
// –ë—ç–∫–µ–Ω–¥
async function sendPushNotification(userId, notification) {
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const tokens = await pool.query(
    'SELECT token FROM push_tokens WHERE user_id = $1 AND is_active = true',
    [userId]
  )

  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Expo Push API
  const messages = tokens.rows.map(({ token }) => ({
    to: token,
    sound: 'default',
    title: notification.title,
    body: notification.message,
    data: {
      type: notification.type,
      relatedId: notification.related_id
    }
  }))

  await fetch('https://exp.host/--/api/v2/push/send', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(messages)
  })
}
```

---

## 24. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 24.1: –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**

**–®–∞–≥ 1: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401**
```
–õ—é–±–æ–π –∑–∞–ø—Ä–æ—Å —Å –∏—Å—Ç—ë–∫—à–∏–º accessToken ‚Üí 401 Unauthorized
```

**–®–∞–≥ 2: Axios interceptor**
```typescript
// client/src/services/api.ts

api.interceptors.response.use(
  response => response,
  async error => {
    const originalRequest = error.config

    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true

      try {
        // –ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
        const refreshToken = localStorage.getItem('refreshToken')
        
        const response = await axios.post('/api/auth/refresh', {
          refreshToken
        })

        const { accessToken, refreshToken: newRefreshToken } = response.data.data

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã
        localStorage.setItem('accessToken', accessToken)
        localStorage.setItem('refreshToken', newRefreshToken)

        // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
        originalRequest.headers['Authorization'] = `Bearer ${accessToken}`
        return axios(originalRequest)

      } catch (refreshError) {
        // Refresh —Ç–æ–∫–µ–Ω —Ç–æ–∂–µ –∏—Å—Ç—ë–∫ - –≤—ã–π—Ç–∏
        localStorage.removeItem('accessToken')
        localStorage.removeItem('refreshToken')
        window.location.href = '/login'
        return Promise.reject(refreshError)
      }
    }

    return Promise.reject(error)
  }
)
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã**
```javascript
// current-server/routes/auth.js

POST /api/auth/refresh

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ refresh —Ç–æ–∫–µ–Ω–∞
   const decoded = jwt.verify(refreshToken, SECRET)

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
   SELECT * FROM refresh_tokens 
   WHERE user_id = decoded.userId 
     AND token = refreshToken 
     AND expires_at > NOW()
     AND is_revoked = false

3. –ï—Å–ª–∏ –ù–ï –≤–∞–ª–∏–¥–µ–Ω ‚Üí 401

4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
   const newAccessToken = jwt.sign({ userId, role }, SECRET, { expiresIn: '1h' })
   const newRefreshToken = jwt.sign({ userId }, SECRET, { expiresIn: '7d' })

5. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ refresh —Ç–æ–∫–µ–Ω–∞
   DELETE FROM refresh_tokens WHERE token = oldRefreshToken

6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ refresh —Ç–æ–∫–µ–Ω–∞
   INSERT INTO refresh_tokens (user_id, token, expires_at)
   VALUES (userId, newRefreshToken, NOW() + INTERVAL '7 days')
```

**–®–∞–≥ 4: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "data": {
    "access_token": "–Ω–æ–≤—ã–π_access_token",
    "refresh_token": "–Ω–æ–≤—ã–π_refresh_token"
  }
}
```

---

## 25. –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞

### üéØ **–°–¶–ï–ù–ê–†–ò–ô 25.1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—Ö–æ–¥–∏—Ç**

**–®–∞–≥ 1: –ö–ª–∏–∫ "–í—ã–π—Ç–∏"**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
```

**–®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å**
```http
POST /api/auth/logout
Authorization: Bearer <token>
```

**–®–∞–≥ 3: –ë—ç–∫–µ–Ω–¥**
```javascript
// current-server/routes/auth.js

1. –£–¥–∞–ª–µ–Ω–∏–µ refresh —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   DELETE FROM refresh_tokens WHERE user_id = 'user_id'

2. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç Socket.IO
   socket.leave(`user_${user_id}`)
   socket.disconnect()
```

**–®–∞–≥ 4: –§—Ä–æ–Ω—Ç–µ–Ω–¥**
```typescript
1. –£–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
   localStorage.removeItem('accessToken')
   localStorage.removeItem('refreshToken')

2. –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   setUser(null)
   setIsAuthenticated(false)

3. –û—Ç–∫–ª—é—á–∏—Ç—å Socket.IO
   socket.disconnect()

4. –†–µ–¥–∏—Ä–µ–∫—Ç
   navigate('/login')
```

**–®–∞–≥ 5: –û—Ç–≤–µ—Ç**
```json
{
  "success": true,
  "message": "Logged out successfully"
}
```

---

## üìä –î–ò–ê–ì–†–ê–ú–ú–´ –§–õ–û–£

### üîÑ **–¶–∏–∫–ª –∂–∏–∑–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí 2. –í—Ö–æ–¥ ‚Üí 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ‚Üí 4. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
                                                        ‚Üì
8. –í—ã—Ö–æ–¥ ‚Üê 7. –ü—Ä–æ—Ñ–∏–ª—å ‚Üê 6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üê 5. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```

### üé• **–§–ª–æ—É –≤–∏–¥–µ–æ**

```
–ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä ‚Üí –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
                                        ‚Üì           ‚Üì
                                    –°—á—ë—Ç—á–∏–∫    –õ–∞–π–∫–∏/–ö–æ–º–º–µ–Ω—Ç—ã
```

### üõ†Ô∏è **–§–ª–æ—É –∑–∞–∫–∞–∑–∞**

```
–°–æ–∑–¥–∞–Ω–∏–µ ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è ‚Üí –û—Ç–∫–ª–∏–∫–∏ ‚Üí –í—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞ ‚Üí –í —Ä–∞–±–æ—Ç–µ ‚Üí –ó–∞–≤–µ—Ä—à—ë–Ω
  (–∫–ª–∏–µ–Ω—Ç)    (–ª–µ–Ω—Ç–∞)    (–º–∞—Å—Ç–µ—Ä–∞)   (–∫–ª–∏–µ–Ω—Ç)    (–ø—Ä–æ—Ü–µ—Å—Å)   (–æ—Ü–µ–Ω–∫–∞)
```

### üí¨ **–§–ª–æ—É —á–∞—Ç–∞**

```
–°–æ–∑–¥–∞–Ω–∏–µ ‚Üí –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Socket.IO ‚Üí –û–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ ‚Üí Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    ‚Üì                                      ‚Üì
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üê Push ‚Üê –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üê –û—Ç–ø—Ä–∞–≤–∫–∞
```

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)**

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `videos` - –≤–∏–¥–µ–æ
- `video_likes` - –ª–∞–π–∫–∏ –≤–∏–¥–µ–æ
- `video_comments` - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- `video_views` - –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
- `video_bookmarks` - –∑–∞–∫–ª–∞–¥–∫–∏
- `subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏
- `orders` - –∑–∞–∫–∞–∑—ã
- `order_responses` - –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ –∑–∞–∫–∞–∑—ã
- `chats` - —á–∞—Ç—ã
- `chat_messages` - —Å–æ–æ–±—â–µ–Ω–∏—è
- `chat_participants` - —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–æ–≤
- `notifications` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `push_tokens` - —Ç–æ–∫–µ–Ω—ã –¥–ª—è push
- `refresh_tokens` - refresh —Ç–æ–∫–µ–Ω—ã

### **Socket.IO —Å–æ–±—ã—Ç–∏—è**

**Client ‚Üí Server:**
- `join` - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
- `leave` - –ø–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
- `typing` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç

**Server ‚Üí Client:**
- `notification` - –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- `message` - –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
- `user_online` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–Ω–ª–∞–π–Ω
- `user_offline` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ—Ñ–ª–∞–π–Ω

### **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

**–ë—ç–∫–µ–Ω–¥ ‚Üí –§—Ä–æ–Ω—Ç–µ–Ω–¥:**
```
snake_case (–ë–î) ‚Üí snake_case (API) ‚Üí camelCase (Frontend)
```

**ApiService –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
1. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `snake_case` ‚Üí `camelCase`
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
3. –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

---

## ‚úÖ –ò–¢–û–ì–û–í–ê–Ø –ö–ê–†–¢–ê –í–°–ï–• –°–¶–ï–ù–ê–†–ò–ï–í

| ‚Ññ | –°—Ü–µ–Ω–∞—Ä–∏–π | –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | Real-time |
|---|----------|-----------|-------------|-----------|
| 1 | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | POST /api/auth/register | ‚ùå | ‚ùå |
| 2 | –í—Ö–æ–¥ | POST /api/auth/login | ‚ùå | ‚ùå |
| 3 | –õ–µ–Ω—Ç–∞ –≤–∏–¥–µ–æ | GET /api/videos/feed | ‚ö™ | ‚ùå |
| 4 | –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ | GET /api/videos/:id | ‚ö™ | ‚ùå |
| 5 | –ü–æ–∏—Å–∫ | GET /api/search | ‚ö™ | ‚ùå |
| 6 | –õ–∞–π–∫ | POST /api/videos/:id/like | ‚úÖ | ‚úÖ |
| 7 | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π | POST /api/videos/:id/comment | ‚úÖ | ‚úÖ |
| 8 | –ó–∞–∫–ª–∞–¥–∫–∏ | POST /api/videos/:id/bookmark | ‚úÖ | ‚ùå |
| 9 | –ü–æ–¥–ø–∏—Å–∫–∞ | POST /api/users/:id/subscribe | ‚úÖ | ‚úÖ |
| 10 | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ | POST /api/orders/create | ‚úÖ | ‚úÖ |
| 11 | –û—Ç–∫–ª–∏–∫ –Ω–∞ –∑–∞–∫–∞–∑ | POST /api/orders/:id/response | ‚úÖ | ‚úÖ |
| 12 | –ü—Ä–∏–Ω—è—Ç–∏–µ –æ—Ç–∫–ª–∏–∫–∞ | POST /api/orders/:id/accept | ‚úÖ | ‚úÖ |
| 13 | –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ | PUT /api/orders/:id/status | ‚úÖ | ‚úÖ |
| 14 | –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞ | POST /api/chat/create-with-user | ‚úÖ | ‚úÖ |
| 15 | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è | POST /api/chat/:id/message | ‚úÖ | ‚úÖ |
| 16 | –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ | POST /api/videos/upload | ‚úÖ | ‚úÖ |
| 17 | –ü—Ä–æ—Ñ–∏–ª—å | GET /api/auth/profile | ‚úÖ | ‚ùå |
| 18 | –ö–∞–Ω–∞–ª –º–∞—Å—Ç–µ—Ä–∞ | GET /api/videos/master/:id | ‚ö™ | ‚ùå |
| 19 | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | GET /api/notifications | ‚úÖ | ‚úÖ |
| 20 | Push-—Ç–æ–∫–µ–Ω | POST /api/push/register | ‚úÖ | ‚ùå |
| 21 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ | POST /api/auth/refresh | ‚ùå | ‚ùå |
| 22 | –í—ã—Ö–æ–¥ | POST /api/auth/logout | ‚úÖ | ‚ùå |

**–õ–µ–≥–µ–Ω–¥–∞:**
- ‚úÖ - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
- ‚ö™ - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- ‚ùå - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

---

## üéØ –ö–û–ù–ï–¶ –î–û–ö–£–ú–ï–ù–¢–ê

–≠—Ç–æ –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è MebelPlace.
–ö–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –≤–∫–ª—é—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏, API –∑–∞–ø—Ä–æ—Å—ã, –ª–æ–≥–∏–∫—É –±—ç–∫–µ–Ω–¥–∞ –∏ –æ—Ç–≤–µ—Ç—ã.

