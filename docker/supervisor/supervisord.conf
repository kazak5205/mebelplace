[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/nginx.err.log
stdout_logfile=/var/log/supervisor/nginx.out.log

[program:backend]
command=node index.js
directory=/app/server
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/backend.err.log
stdout_logfile=/var/log/supervisor/backend.out.log
environment=NODE_ENV=production

[program:cleanup]
command=node -e "
const cron = require('node-cron');
const { cleanupInactiveSubscriptions } = require('./services/pushService');

// Cleanup inactive subscriptions every day at 2 AM
cron.schedule('0 2 * * *', () => {
  console.log('🧹 Running cleanup task...');
  cleanupInactiveSubscriptions().then(result => {
    console.log('✅ Cleanup completed:', result);
  }).catch(err => {
    console.error('❌ Cleanup failed:', err);
  });
});

// Keep the process running
process.on('SIGTERM', () => process.exit(0));
process.on('SIGINT', () => process.exit(0));
"
directory=/app/server
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/cleanup.err.log
stdout_logfile=/var/log/supervisor/cleanup.out.log

